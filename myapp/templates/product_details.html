{% extends 'base.html' %}
{% load static %}
{% block content %}

{% csrf_token %}

<div class="row" style="margin-top: 70px;">
    <!-- IMAGE -->
    <div class="col-lg-5">
        <div class="mx-5 prod-border m-5 d-flex justify-content-center">
            <img src="{{ product.image.url }}" class="img-fluid prod-img" alt="{{ product.name }}">
        </div>
    </div>

    <!-- DETAILS -->
    <div class="col-lg-6">
        <div class="row mt-5 ms-5 prod-font1">
            <p>{{ product.name }}</p>
        </div>

        <div class="row ms-5">
            <p>{{ product.description }}</p>
        </div>

        <div class="row mt-5 ms-5">
            <p class="prod-font3">MRP: â‚¹{{ product.price }}</p>
        </div>

        <!-- SIZE (UI ONLY for now) -->
        <div class="row mt-1 ms-5">
            <p class="prod-font2">Select size:</p>
            <div class="prod-size d-flex flex-wrap">
                {% for size in sizes %}
                    <button class="prod-size-select">UK-{{ size }}</button>
                {% endfor %}
            </div>  
        </div>

        <!-- ADD TO CART -->
        <div class="row mt-5">
            <div class="d-flex justify-content-center">
                <button class="prod-cart-btn" onclick="addToCart('{{ product.id }}')">
                    Add to Cart
                </button>
            </div>
        </div>

        <!-- BUY NOW -->
        <div class="row mt-2 mb-5">
            <div class="d-flex justify-content-center">
                <button class="prod-cart-btn-buy" onclick="buyNow('{{ product.id }}')">
                    Buy Now
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function getCSRF() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}

function addToCart(productId) {
    fetch("{% url 'add_to_cart' 0 %}".replace('0', productId), {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCSRF()
        }
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            alert(data.message);
        } else if (data.message === 'Please login first') {
            window.location.href = "{% url 'login' %}";
        } else {
            alert(data.message);
        }
    });
}

function buyNow(productId) {
    fetch("{% url 'add_to_cart' 0 %}".replace('0', productId), {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCSRF()
        }
    })
    .then(() => {
        window.location.href = "{% url 'cart' %}";
    });
}
</script>

{% endblock %}
